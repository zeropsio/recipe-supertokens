#yamlPreprocessor=on
project:
  name: recipe-supertokens
  tags:
    - zerops-recipe

services:
  - hostname: db
    type: postgresql@16
    mode: NON_HA
    priority: 100

  - hostname: supertokens
    type: ubuntu@22.04
    buildFromGit: https://github.com/zeropsio/recipe-supertokens
    enableSubdomainAccess: true
    envSecrets:
      API_KEYS: <@generateRandomString(<32>) | toHex>
      URL: https://${hostname}-${core_zeropsSubdomainHost}-3567.prg1.zerops.app
    verticalAutoscaling:
      minRam: 0.5
      startCpuCoreCount: 3
    priority: 90

  - hostname: mailpit
    type: go@1.22
    buildFromGit: https://github.com/zeropsio/recipe-mailpit@main
    enableSubdomainAccess: true
    priority: 90

  - hostname: nodejsbackend
    type: nodejs@22
    buildFromGit: https://github.com/zeropsio/recipe-supertokens
    enableSubdomainAccess: true
    envSecrets:
      URL: https://${hostname}-${core_zeropsSubdomainHost}-3001.prg1.zerops.app
      API_DOMAIN: ${URL}
      APP_NAME: zerops-recipe
      SMTP_FROM_EMAIL: no-reply@example.com
      SMTP_FROM_NAME: zerops
      SMTP_HOST: ${mailpit_hostname}
      SMTP_PORT: "1025"
      SUPERTOKENS_ADMIN_EMAIL: admin@example.com
      SUPERTOKENS_ADMIN_PASSWORD: <@generateRandomString(<12>) | toHex>xY1_
      SUPERTOKENS_SEED_USER_EMAIL: admin@example.com
      SUPERTOKENS_API_KEY: ${supertokens_API_KEYS}
      SUPERTOKENS_CONNECTION_URI: ${supertokens_URL}
      SUPERTOKENS_INSTANCE: ${supertokens_URL}
      WEBSITE_DOMAIN: ${angularfrontend_URL}

  - hostname: angularfrontend
    type: static
    enableSubdomainAccess: true
    buildFromGit: https://github.com/zeropsio/recipe-supertokens
    envSecrets:
      URL: https://${hostname}-${core_zeropsSubdomainHost}.prg1.zerops.app
      API_DOMAIN: ${nodejsbackend_URL}
      APP_NAME: ${nodejsbackend_APP_NAME}
      WEBSITE_DOMAIN: ${URL}

