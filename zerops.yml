zerops:
  - setup: supertokens
    build:
      buildCommands:
        - echo "noop"
      deployFiles: ./supertokens-core/~
    run:
      base: ubuntu@22.04
      prepareCommands:
        - curl 'https://api.supertokens.com/0/user/app/download?pluginName=postgresql&os=linux&core=9.3.0&api-version=0' --output supertokens.zip
        - unzip supertokens.zip
        - cd supertokens && sudo sh install
      ports:
        - port: 3567
          httpSupport: true
      envVariables:
        POSTGRESQL_PASSWORD: ${db_password}
        POSTGRESQL_HOST: ${db_hostname}
        POSTGRESQL_PORT: ${db_port}
        POSTGRESQL_DATABASE_NAME: ${db_dbName}
        POSTGRESQL_USER: ${db_user}
        SUPERTOKENS_PORT: 3567
      initCommands:
        - sh setup-envs.sh
      start: supertokens start --foreground --with-config="/tmp/supertokens-config.yml"
  - setup: dashboard
    build:
      base: nodejs@22
      buildCommands:
        - |
          cd supertokens-dashboard
          npm i
      deployFiles: ./supertokens-dashboard/~
    run:
      base: nodejs@22
      initCommands:
        - zsc execOnce init -- sh create-user.sh
      ports:
        - port: 3001
          httpSupport: true
      start: npm start




